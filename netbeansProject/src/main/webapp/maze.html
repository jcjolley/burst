
<!doctype html>
<html lang="en">
<head>
	<title>Labyrinth</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link rel=stylesheet href="css/base.css"/>
	<style>
		/*From pointerLock: https://github.com/mrdoob/three.js/blob/master/examples/misc_controls_pointerlock.html */
			html, body {
				width: 100%;
				height: 100%;
			}

			body {
				background-color: #ffffff;
				margin: 0;
				overflow: hidden;
				font-family: arial;
			}

			#blocker {

				position: absolute;

				width: 100%;
				height: 100%;

				background-color: rgba(0,0,0,0.5);

			}

			#instructions {

				width: 100%;
				height: 100%;

				display: -webkit-box;
				display: -moz-box;
				display: box;

				-webkit-box-orient: horizontal;
				-moz-box-orient: horizontal;
				box-orient: horizontal;

				-webkit-box-pack: center;
				-moz-box-pack: center;
				box-pack: center;

				-webkit-box-align: center;
				-moz-box-align: center;
				box-align: center;

				color: #ffffff;
				text-align: center;

				cursor: pointer;

			}

		</style>
</head>
<body>
<div id="blocker">

			<div id="instructions">
				<span style="font-size:40px">Click to play</span>
				<br />
				(W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)
			</div>

		</div>

<div id="message"></div>
<script src="js/three.min.js"></script>
<script src="js/Stats.js"></script>
<script src="js/wallBuilder.js"></script>
<script src="js/initialize.js"></script>
<script src="js/PointerLockControls.js" type="text/javascript"></script>
<!-- jQuery code to display an information button and box when clicked. -->
<script src="js/jquery-1.9.1.js"></script>
<script src="js/jquery-ui.js"></script>
<link rel=stylesheet href="css/jquery-ui.css" />
<link rel=stylesheet href="css/info.css"/>
<script src="js/info.js"></script>
<div id="infoButton"></div>
<div id="infoBox" title="Demo Information">
Movement controls: <br/>
<ul>
<li>W/S: Translate Forward/Backward
<li>A/D: Rotate Left/Right
<li>Q/E: Translate Left/Right
<li>R/F: Rotate Up/Down
<li>Z: Reset position and rotation.
<li>Space/N: Translate Up/Down
</ul>
</div>

<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>

<script>
/*
	Template for this file was taken from Three.js "tutorials by example" by Lee Stemkoski
*/

// MAIN

// global variables
var container, scene, camera, renderer, stats, cameraHeight, loader;
var clock = new THREE.Clock();
var skyBox;
var MovingCube;
var size = 40;
loader = new THREE.TextureLoader();
cameraHeight = 25;

var blocker = document.getElementById( 'blocker' );
			var instructions = document.getElementById( 'instructions' );

			// http://www.html5rocks.com/en/tutorials/pointerlock/intro/

			var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

			if ( havePointerLock ) {

				var element = document.body;

				var pointerlockchange = function ( event ) {

					if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {

						controlsEnabled = true;
						controls.enabled = true;

						blocker.style.display = 'none';

					} else {

						controls.enabled = false;

						blocker.style.display = '-webkit-box';
						blocker.style.display = '-moz-box';
						blocker.style.display = 'box';

						instructions.style.display = '';

					}

				};

				var pointerlockerror = function ( event ) {

					instructions.style.display = '';

				};

				// Hook pointer lock state change events
				document.addEventListener( 'pointerlockchange', pointerlockchange, false );
				document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
				document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );

				document.addEventListener( 'pointerlockerror', pointerlockerror, false );
				document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
				document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );

				instructions.addEventListener( 'click', function ( event ) {

					instructions.style.display = 'none';

					// Ask the browser to lock the pointer
					element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

					if ( /Firefox/i.test( navigator.userAgent ) ) {

						var fullscreenchange = function ( event ) {

							if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {

								document.removeEventListener( 'fullscreenchange', fullscreenchange );
								document.removeEventListener( 'mozfullscreenchange', fullscreenchange );

								element.requestPointerLock();
							}

						};

						document.addEventListener( 'fullscreenchange', fullscreenchange, false );
						document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );

						element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

						element.requestFullscreen();

					} else {

						element.requestPointerLock();

					}

				}, false );

			} else {

				instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

			}

$.ajax({
		url: 'http://localhost:8084/rest/sp/jsonMaze?size=' + size,
		dataType: 'json',
		type: 'GET',
		async: true,
		error: function (jqXHR, status, errorThrown) {
			alert('error');
		}
	}).done(function (data) {
		initWallVars(size);
		goodMaze = data;
		buildSimpleLaby(goodMaze);
	});
		init(size);
		animate();
// FUNCTIONS
function animate(time) 
{
    requestAnimationFrame( animate );
	render(time);		
	update();
}

function update()
{
	//var oldX = MovingCube.position.x;
	//var oldY = MovingCube.position.y;
	//var oldZ = MovingCube.position.z;
	//getMovement();	

	//camera.position.x = MovingCube.position.x;
	//camera.position.y = MovingCube.position.y;
	//camera.position.z = MovingCube.position.z;
	stats.update();
}

function render(time) 
{
	cpos = camera.position;
	camera.position.set(cpos.x, cameraHeight, cpos.z);
	renderer.render( scene, camera );
}


</script>

</body>
</html>
	